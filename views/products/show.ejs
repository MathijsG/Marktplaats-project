<% include ../partials/header %>

<!--Begin carousel  -->
<div class="row">
  <div class="col-lg-8">
    <% if (product.images.length > 0 ) { %>
    <div id="carousel">
      <div class="carousel slide overflow-hidden" data-ride="carousel">
        <div class="carousel-inner">
          <% product.images.forEach(function(image) { %>
          <div class="carousel-item">
            <img class="d-block w-100" src="/uploads/products/<%=image%>">
          </div>
          <% }); %>
        </div>
      </div>
    </div>
    <% } else { %>
    <img src="/images/product_placeholder.png" width="310" height="200">
    <% } %>
    <h1 class="card-title"><%=product.title%></h3>
      <h4>Prijs &euro;<%=product.price%></h4>
  </div>

  <!--Einde carousel  -->

  <% if (product.images.length > 0 ) { %>
  <div id="thumbnails" class="col justify-content-center">
    <div class="row d-flex justify-content-center">
      <% product.images.forEach(function(image) { %>
      <div class="col-6 card-deck">
        <div class="card rounded d-flex align-items-center justify-content-center p-2 m-1">
          <img class="cover thumbnail" src="/uploads/products/<%=image%>" width="100">
        </div>
      </div>
      <% }); %>
    </div>
  </div>
  <% } %>
</div>

<!--  -->

<div class="row">
  <div class="col-lg-8">
    <div class="text-justify">
      <%=product.body%>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="card rounded shadow card-deck mb-2">
      <div class="card-body">
        <div class="card-title">
          <h5>Advertentiebeheer</h5>
        </div>
        <a class="btn btn-info d-inline p-2" href="/advertenties/<%=product.id%>/edit"><i class="fa fa-pencil" aria-hidden="true"></i> Bewerken</a>
        <form action="/advertenties/<%=product.id%>?_method=DELETE" class="d-inline" method="POST"
          onclick="return confirm('Weet u zeker dat u \'<%=product.title%>\' wil verwijderen?')">
          <button class="btn btn-danger d-inline"><i class="fa fa-times" aria-hidden="true"></i> Verwijderen</button>
        </form>
      </div>
    </div>
    <!-- location -->
    <div class="card rounded shadow card-deck mb-2">
      <div class="card-body">
        <div class="card-title">
          <h2>Advertentie-informatie</h2>
        </div>
        <% if (product.location.coordinates.length > 0 ) { %>
        <div id="locationMap"></div>
        <% } else { %>
          <div class="card-text">
            Geen locatie beschikbaar.
          </div>
        <% } %>
      </div>
    </div>
    <div class="card rounded shadow card-deck mb-2">
      <div class="card-body">
        <div class="card-title">
          <h2>Biedt u mee?</h2>
        </div>
        <form action="/advertenties/<%=product._id%>/bids" method="POST">
          <input class="form-control" type="number" name="bid[amount]" id="bid" min="0" required>
          <span class="text-muted">Bieden vanaf &euro;<%=product.minprice%></span>
          <button class="btn btn-warning btn-block mt-2" type="submit"><i class="fa fa-gavel text-white" aria-hidden="true"></i> Bied</button>
        </form>
      </div>
    </div>
    <div class="card rounded shadow card-deck">
      <div class="card-body">
        <div class="card-title">
          <h3>Biedingsverloop</h3>
        </div>
        <% if (product.bids.length > 0) { %>
        <ul class="list-group list-group-flush">
          <% product.bids.forEach(function(bid){ %>
          <li class="list-group-item">
            <date><%=moment(bid.createdAt).format("DD MMM 'YY")%></date> - <strong>&euro;<%=bid.amount%></strong>
          </li>
          <% }) %>
        </ul>
        <% } else { %>
        <p class="text-muted">Er zijn nog geen biedingen geplaatst.</p>
        <% } %>
      </div>
    </div>
  </div>
</div>
<% if (product.location.coordinates.length > 0 ) { %>
<script>
    let defaultCenter = [<%=product.location.coordinates%>];
    let defaultZoomLevel = 19; // Max zoom because now it's already a specific location
    let locationMap = L.map("locationMap").setView(defaultCenter, defaultZoomLevel);

  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}',
    {
      maxZoom: 18,
      id: 'mapbox.streets',
      accessToken: 'pk.eyJ1IjoibXNnYmlnaG91c2UiLCJhIjoiY2sxaHdrY214MDZkbDNoanpwNW9rcjRsOSJ9.YXMtqR_k0YWeKNnAZHmhdg'
    })
    .addTo(locationMap);
    L.marker([<%=product.location.coordinates%>]).addTo(locationMap);
</script>
<% } %>
<% include ../partials/footer %>